"use strict";
/*
  Copyright 2019 Google LLC

  Use of this source code is governed by an MIT-style
  license that can be found in the LICENSE file or at
  https://opensource.org/licenses/MIT.
*/
exports.__esModule = true;
exports.cleanupOutdatedCaches = void 0;
var cacheNames_js_1 = require("workbox-core/_private/cacheNames.js");
var logger_js_1 = require("workbox-core/_private/logger.js");
var deleteOutdatedCaches_js_1 = require("./utils/deleteOutdatedCaches.js");
require("./_version.js");
/**
 * Adds an `activate` event listener which will clean up incompatible
 * precaches that were created by older versions of Workbox.
 *
 * @memberof module:workbox-precaching
 */
function cleanupOutdatedCaches() {
    // See https://github.com/Microsoft/TypeScript/issues/28357#issuecomment-436484705
    self.addEventListener('activate', (function (event) {
        var cacheName = cacheNames_js_1.cacheNames.getPrecacheName();
        event.waitUntil(deleteOutdatedCaches_js_1.deleteOutdatedCaches(cacheName).then(function (cachesDeleted) {
            if (process.env.NODE_ENV !== 'production') {
                if (cachesDeleted.length > 0) {
                    logger_js_1.logger.log("The following out-of-date precaches were cleaned up " +
                        "automatically:", cachesDeleted);
                }
            }
        }));
    }));
}
exports.cleanupOutdatedCaches = cleanupOutdatedCaches;
