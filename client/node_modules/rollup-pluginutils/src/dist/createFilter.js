"use strict";
exports.__esModule = true;
exports["default"] = void 0;
var micromatch_1 = require("micromatch");
var path_1 = require("path");
var ensureArray_1 = require("./utils/ensureArray");
function getMatcherString(id, resolutionBase) {
    if (resolutionBase === false) {
        return id;
    }
    return path_1.resolve.apply(void 0, (typeof resolutionBase === 'string' ? [resolutionBase, id] : [id]));
}
var createFilter = function createFilter(include, exclude, options) {
    var resolutionBase = options && options.resolve;
    var getMatcher = function (id) {
        return id instanceof RegExp
            ? id
            : {
                test: micromatch_1["default"].matcher(getMatcherString(id, resolutionBase)
                    .split(path_1.sep)
                    .join('/'), { dot: true })
            };
    };
    var includeMatchers = ensureArray_1["default"](include).map(getMatcher);
    var excludeMatchers = ensureArray_1["default"](exclude).map(getMatcher);
    return function (id) {
        if (typeof id !== 'string')
            return false;
        if (/\0/.test(id))
            return false;
        id = id.split(path_1.sep).join('/');
        for (var i = 0; i < excludeMatchers.length; ++i) {
            var matcher = excludeMatchers[i];
            if (matcher.test(id))
                return false;
        }
        for (var i = 0; i < includeMatchers.length; ++i) {
            var matcher = includeMatchers[i];
            if (matcher.test(id))
                return true;
        }
        return !includeMatchers.length;
    };
};
exports["default"] = createFilter;
