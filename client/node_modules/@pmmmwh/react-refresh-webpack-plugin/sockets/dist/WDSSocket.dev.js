"use strict";

/* global __webpack_dev_server_client__ */
var url = require('native-url');

var getSocketUrlParts = require('./utils/getSocketUrlParts');
/**
 * Initializes a socket server for HMR for webpack-dev-server.
 * @param {function(*): void} messageHandler A handler to consume Webpack compilation messages.
 * @param {string} [resourceQuery] Webpack's `__resourceQuery` string.
 * @returns {void}
 */


function initWDSSocket(messageHandler, resourceQuery) {
  if (typeof __webpack_dev_server_client__ !== 'undefined') {
    var SocketClient = __webpack_dev_server_client__;
    var urlParts = getSocketUrlParts(resourceQuery);
    var connection = new SocketClient(url.format(urlParts));
    connection.onMessage(function onSocketMessage(data) {
      var message = JSON.parse(data);
      messageHandler(message);
    });
  }
}

module.exports = initWDSSocket;